@using BanleWebsite.Services;
@using BanleWebsite.Models;
@using BanleWebsite.Repository;
@{

    ViewBag.Title = "Giỏ hàng";
    List<CartItem> cart = ViewBag.cart;
    ProductServices _productServices = new ProductServices();
    OrderServices _orderServices = new OrderServices();
    ColorServices _colorServices = new ColorServices();
    SizeServices _sizeServices = new SizeServices();
    int itemInCart = _orderServices.getNumberOfItemInCart();
    double total = 0;

    string link = ViewBag.link;

}


<style>
    /*div{
        border: 1px solid black;
    }*/
    h3 {
        font-family:VNOswald;
    }

</style>

<div class="container">
    @{ 
        if (itemInCart == 0)
        {
            <section style="text-align:center;">
                <img src="~/Content/SiteImages/empty_bin.png" />
                <div class="row">
                    <a href="@link">Tiếp tục mua sắm</a>
                </div>
            </section>
        }
        else
        {
            <h2 style="font-family:VNOswald; text-align:center; margin:10px;">Giỏ hàng của bạn</h2>
            <section>
                <div id="cart" style="max-width:700px; border: 1px solid #9D3BC6; border-radius:4px; margin:auto;">
                    @{
                        foreach (var item in cart)
                        {
                            Product p = _productServices.findByID(item.productId);
                            double thanhtien = p.Price.Value * item.quantity;
                            total += thanhtien;
                            <div id="item" style="max-width:680px; margin:auto; padding:10px; border-bottom:1px solid #9D3BC6; padding-bottom:40px;">
                                <a href="/Sanpham/@p.GenerateSlug()" style="text-decoration:none; cursor:pointer;">
                                    <img height="80" width="80" src="@p.Img1" style="float:right;" />
                                </a>
                                <h3 style="text-align:left;">@p.Name</h3>
                                <h3 style="text-align:left; color:red; font-size:20px; font-family:VNOswald;">@p.Price VND</h3>
                                <p style="font-family:VNOswald; font-size:17px;">Màu áo: @_colorServices.findByID(item.color).Name</p>
                                <p style="font-family:VNOswald; font-size:17px;">Kích cỡ: @_sizeServices.findByID(item.size).Name</p>
                                <div class="clearfix"></div>
                                <div class="action" style="display:block; margin-top:10px;">
                                    <p style="display:block; float:left; font-family:VNOswald; font-size:20px; margin:5px 10px 0 0;">Số lượng: </p>
                                    @using (Html.BeginForm("UpdateQuantity", "Cart", FormMethod.Post, new { enctype = "multipart/form-data", @style = "margin-bottom:0; margin-left:10px;" }))
                                    {
                                        <input type="hidden" class="form-control" value="@item.productId" name="productId" />
                                        <input type="text" class="form-control" value="@item.quantity" name="quantity" style="width:20px; margin: 0 0 0 0; display:block; float:left;" />
                                        <input type="hidden" class="form-control" value="@item.color" name="color" />
                                        <input type="hidden" class="form-control" value="@item.size" name="size" />
                                        <input type="submit" value="Cập nhật" style="font-family:VNOswald; margin: 0 0 0 0; display:block; float:left;" />
                                    }

                                    @using (Html.BeginForm("DeleteCartItem", "Cart", FormMethod.Post, new { enctype = "multipart/form-data", @style = "margin-bottom:0px; margin-right:10px;" }))
                                    {
                                        <input type="hidden" class="form-control" value="@item.productId" name="productId" />
                                        <input type="hidden" class="form-control" value="@item.color" name="color" />
                                        <input type="hidden" class="form-control" value="@item.size" name="size" />
                                        <input type="submit" value="Xóa" style="margin: 0 0 0 0; display:block;float:right;" />
                                    }
                                </div>
                            </div>
                        }
                    }

                    <div id="total" style="max-width:680px; border-bottom:1px solid #9D3BC6; padding:10px;">
                        <b style="font-size:18px; font-family:VNOswald;">Tổng tiền</b><br /><br />
                        <strong style="color:red; font-family:VNOswald; font-size:18px;">@total VND</strong>
                    </div>
                    <div id="cusInfo" style="max-width:700px; margin:auto; text-align:center;">
                        @using (Html.BeginForm("SubmitOrder", "Cart", FormMethod.Post, new { enctype = "multipart/form-data", onsubmit = "return check()" }))
                        {
                            <div class="form-inline">
                                <input type="text" placeholder="Họ và tên" id="name" name="name" style="margin:10px; height:30px; width:220px;" />
                                <input type="text" placeholder="Số điện thoại" id="phone" name="phoneNo" style="margin:10px; height:30px; width:220px;" />
                            </div>
                            <div class="form-inline">
                                <input type="text" placeholder="Email" id="email" name="email" style="margin:10px; height:30px; width:220px;" />
                                <input type="text" placeholder="Địa chỉ" id="address" name="address" style="margin:10px; height:30px; width:220px;" />
                            </div>
                            <input type="submit" style="font-size:25px; padding:20px 55px 50px 55px; margin-top:10px;" value="Mua ngay" />
                        }
                    </div>
                </div>

                <div style="margin-top:20px; text-align:center;">
                    <a href="@link">Tiếp tục mua sắm</a>
                </div>
            </section>
            
                        }
    }
    
</div>

<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-sm">

        <!-- Modal content-->
        <div class="modal-content" style="background-color:#f9f2f4;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="font-family:VNOswald;">Lỗi</h4>
            </div>
            <div class="modal-body" style="text-align:center; background-color:#f9f2f4;">
                <p><span class="glyphicon glyphicon-remove"></span></p>
                <p style="color:#c7254e; font-size:20px;">Vui lòng nhập <strong>Họ tên</strong> và <strong>Số điện thoại!</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">OK</button>
            </div>
        </div>

    </div>
</div>

<script>
    function check() {
        var name = jQuery("#name").val();
        var phone = jQuery("#phone").val();

        if (name == null || name == "" || phone == null || phone == "") {
            jQuery("#myModal").modal("toggle");
            return false;
        }
    }
</script>
